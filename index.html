<!DOCTYPE html>
<html lang="en" class="h-100">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="description" content="" />
    <meta name="author" content="" />
    <title>ESP Launchpad</title>
    <!-- Favicon-->
    <link rel="icon" type="image/x-icon" href="../assets/favicon.ico" />
    <!-- Core theme CSS (includes Bootstrap)-->
    <link href="../css/styles.css" rel="stylesheet" />
    <link href="../css/custom.css" rel="stylesheet" />
    <link href="../css/xterm.css" rel="stylesheet" />
    <link rel="stylesheet" href="./minimal_ui_styles.css" />
</head>

<body class="d-flex flex-column h-100" style="align-items: center">
    <!-- Modal for error troubleshoot starts-->
    <button type="button" id="errorTroubleshootModalToggleButton" class="btn btn-primary" data-bs-toggle="modal"
        data-bs-target="#errorTroubleshootModal" hidden>
        故障排查模态框切换按钮
    </button>
    <div class="modal fade" id="errorTroubleshootModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
        aria-labelledby="errorTroubleshootModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="errorTroubleshootModalTitle">正在连接</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" hidden></button>
                </div>
                <div class="modal-body">
                    <p id="errorMessageDescription">设备连接耗时较长。</p>
                    <p class="errorMessage" id="errorMessage" style="display: none;"></p>
                    <p id="troubleshootAccordionLabel">请参考下方故障排查指南以获取帮助。</p>
                    <div class="accordion" id="troubleshootAccordion">
                        <div class="accordion-item border-0">
                            <h2 class="accordion-header" id="headingOne">
                                <button class="accordion-button collapsed" style="background-color: #eee;" type="button"
                                    data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true"
                                    aria-controls="collapseOne">
                                    故障排查指南
                                </button>
                            </h2>
                            <div id="collapseOne" class="accordion-collapse collapse" aria-labelledby="headingOne"
                                data-bs-parent="#troubleshootAccordion">
                                <div class="accordion-body" style="font-size: 12px;">
                                    <div class="container mt-2">
                                        <div>
                                            <div class="col-xs-12">
                                                <div class="col-xs-12 mt-2">
                                                    <h4 class="topic mb-2" style="font-size: 14px;"><b>设备连接问题</b></h4>
                                                    <p>
                                                        如果在建立连接时的弹窗列表中未看到您的设备，可能是设备未正确连接到端口，或存在
                                                        <strong>浏览器兼容性问题</strong>。请确认设备已正确插入端口，尝试重新插拔连接线也可能有帮助。如果设备被其他应用占用，请先断开后再试。
                                                    </p>
                                                </div>
                                                <div class="col-xs-12 mt-2">
                                                    <h4 class="topic mb-2" style="font-size: 14px;">
                                                        <b>串口读写权限问题</b>
                                                    </h4>
                                                    <div class="mb-3">
                                                        对于 Linux 用户，当前登录用户需要具备通过 USB 访问串口的读写权限。大多数发行版可通过将用户加入 dialout 组实现：
                                                        <div class="command-snippet"> usermod -a -G dialout $USER </div>
                                                        在 Arch Linux 上则需要将用户加入 uucp 组：
                                                        <div class="command-snippet"> sudo usermod -a -G uucp $USER </div>
                                                        执行后请重新登录以生效串口读写权限。
                                                    </div>
                                                </div>
                                                <div class="col-xs-12 mt-2">
                                                    <h4 class="topic mb-2" style="font-size: 14px;"><b>浏览器兼容性问题</b></h4>
                                                    <p>
                                                        <span style="color: #e63f36">
                                                            本工具暂不支持 Safari 和 Firefox！
                                                        </span>
                                                        请使用已支持的浏览器，例如 <strong>Google Chrome</strong>。
                                                    </p>
                                                    <p>
                                                        ESP Launchpad 通过 <strong>Web Serial API</strong> 与设备通信。目前 Safari 与 Firefox 尚未支持。
                                                        一旦浏览器支持 Web Serial API，我们会尽快适配。可在此处查看
                                                        <a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Serial_API#browser_compatibility"
                                                            target="_blank">Web Serial API 浏览器兼容性</a>。
                                                    </p>
                                                </div>
                                                <div class="col-xs-12 mt-2">
                                                    <h4 class="topic mb-2" style="font-size: 14px;"><b>设备兼容性问题</b></h4>
                                                    <p>
                                                        如果您使用的是较旧的设备或固件，可能会在建立连接或烧录固件时遇到问题。请尝试按下设备上的 Boot 按钮后重试。
                                                    <details>
                                                        <summary>ESP Launchpad 支持的设备列表</summary>
                                                        <ol>
                                                            <li>ESP32</li>
                                                            <li>ESP32-C3</li>
                                                            <li>ESP32-C6</li>
                                                            <li>ESP32-H2</li>
                                                            <li>ESP32-S2</li>
                                                            <li>ESP32-S3</li>
                                                            <li>ESP8266</li>
                                                        </ol>
                                                    </details>
                                                    </p>
                                                </div>
                                                <div class="col-xs-12 mt-2" id="browserSupport">
                                                    <h4 class="topic mb-2" style="font-size: 14px;"><b>Driver Compatability
                                                            Issue</b></h4>
                                                    <p>
                                                        已知在 <strong>Windows 系统</strong>下使用最新版 <strong>Silicon Lab CP210x USB to UART Bridge</strong> 时，可能出现连接或烧录问题，我们正在调查。
                                                        可尝试临时将 CP210x 驱动降级到 <code>6.7.x</code> 版本以缓解。
                                                    </p>
                                                </div>
                                            </div>
                                        </div>
                                        <hr />
                                        <div style="text-align: center;">
                                            <p>如果仍无法解决问题或遇到其他情况，请前往 <a
                                                    href="https://github.com/espressif/esp-launchpad/issues"
                                                    target="_blank">ESP launchpad Issues</a> 反馈。</p>
                                            <p>我们很乐意为您提供帮助！</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer border-top-0">
                    <div class="field-container" data-toggle="tooltip" data-bs-placement="top"
                        title="You can wait some more time, and we'll continue to attempt the connection"
                        style="display: inline-block">
                        <button type="button" class="app-button btn btn-outline-primary" data-bs-dismiss="modal"
                            id="waitButton">
                            继续等待连接
                        </button>
                    </div>
                    <div class="field-container" data-toggle="tooltip" data-bs-placement="top"
                        title="You can try it again !" style="display: inline-block">
                        <button type="button" class="app-button btn btn-outline-dark" onClick="window.location.reload();">
                            重试
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Modal for error troubleshoot ends-->

    <div id="main" class="maincontainer container">
        <!-- Responsive navbar-->
        <nav class="navbar navbar-expand-lg">
            <div class="container">
                <h4 class="topic" data-target-tab-panel-id="about">
                    <img src="../assets/logo-v1.png" class="logo" />
                </h4>
            </div>
        </nav>
        <div class="container" id="alert-container" style="display: none;">
            <div class="text-center mt-3 intro-text">
                <div class="alert alert-warning alert-dismissible fade show" role="alert">
                    <label style="display:none" id="lblConnTo"></label>
                </div>
            </div>
        </div>
        <div
            style="position: absolute;
            top: 50%; left: 50%; transform: translate(-50%, -50%);
            text-align: center;
            display: flex; flex-direction: column; align-items: center;">
            <!-- App Icon and Name Section -->
            <div id="appIconWithNameContainer" style="display: none; margin-bottom: 20px;">
                <div style="margin-bottom: 10px; display: none;" id="appIconDiv">
                    <img id="appIcon" src="" alt="App Icon"
                        style="max-width: 150px; max-height: 150px; object-fit: contain;">
                </div>
                <div>
                    <a href="#" id="appNameLink" role="button" data-bs-toggle="offcanvas"
                        data-bs-target="#offcanvasRight" aria-controls="offcanvasRight"
                        style="font-size: 18px; font-weight: 500; text-decoration: none;">
                        <span id="appName"></span>
                    </a>
                </div>
            </div>
            <!-- Connect Button -->
            <button class="connectButton" id="connectButton" tabindex="0" type="button" disabled>连接设备<span class="span-svg"><svg class="svg" focusable="false" aria-hidden="true" viewBox="0 0 24 24"
                        data-testid="EastIcon">
                        <path fill="#FFFFFF" d="m15 5-1.41 1.41L18.17 11H2v2h16.17l-4.59 4.59L15 19l7-7-7-7z"></path>
                    </svg></span></button>
        </div>
        <div id="spinner" style="display: none; position: absolute; top: 50%;">
            <div>
                <div class="spinner-grow text-secondary bg-opacity-25" role="status">
                    <span class="sr-only"></span>
                </div>
                <div class="spinner-grow text-secondary bg-opacity-50" role="status">
                    <span class="sr-only"></span>
                </div>
                <div class="spinner-grow text-secondary bg-opacity-75" role="status">
                    <span class="sr-only"></span>
                </div>
            </div>
        </div>
        <div class="container">
            <div class="row split">
                <div class="productinfocontainer" id="productInfoContainer">
                    <div id="message" style="display: none"></div>
                </div>
                <div class="col-12 terminalcontainer" style="overflow: hidden; display: none;" id="terminalContainer">
                        <div class="button-container text-end mb-sm-3">
                            <div class="field-container" data-toggle="tooltip" data-placement="right"
                                title="Restart your device" style="display: inline-block">
                                <button type="button" class="app-button btn btn-outline-dark" id="consoleStartButton"
                                    disabled>
                                    Restart Device
                                </button>
                            </div>
                        </div>
                        <div id="terminal"><span class="devicelog">设备控制台</span></div>
                        <div id="commandForm" style="display: none;">
                            <textarea rows="1" class="form-control rounded-0 shadow-none" autocomplete="off" id="commandInput"
                            placeholder="输入命令后按回车" style="font-size: 14px; font-family: monospace;" disabled></textarea>
                        </div>
                </div>
            </div>
        </div>

        <!-- Offcanvas for Application Information -->
        <div class="offcanvas offcanvas-end w-50" tabindex="-1" id="offcanvasRight"
            aria-labelledby="offcanvasRightLabel">
            <div class="offcanvas-body">
                <div id="appInfo"></div>
            </div>
        </div>
    </div>

    <!-- Safari & FireFox not supported error message-->
    <div id="unsupportedBrowserErr" style="display: none">
        <p align="center" style="color: red">
            本工具暂不支持 Safari 和 Firefox。请尝试使用 Google Chrome 等浏览器。
            <br />
            <br />
            ESP Launchpad 通过 WebUSB 与设备通信，Safari 与 Firefox 目前尚未支持。待其支持 WebUSB 后我们会尽快适配。
        </p>
    </div>


    <!-- Third party libraries-->
    <script src="../node_modules/xterm/lib/xterm.js"></script>
    <script src="../node_modules/xterm-addon-fit/lib/xterm-addon-fit.js"></script>
    <script src="../node_modules/crypto-js/crypto-js.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.0.3/pako.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/showdown/2.1.0/showdown.min.js"></script>

    <script src="./minimal_ui_index.js" type="module"></script>
    <!-- Bootstrap core JS-->
    <script src="../js/jquery.min.js"></script>
    <script src="../js/bootstrap.bundle.min.js"></script>
    <script src="../js/qrcode.min.js"></script>
</body>

</html>